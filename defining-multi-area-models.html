<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Defining multi area models | Building models using the Gadget framework</title>
  <meta name="description" content="8 Defining multi area models | Building models using the Gadget framework" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Defining multi area models | Building models using the Gadget framework" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Defining multi area models | Building models using the Gadget framework" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="fitting-a-model-to-data.html"/>
<link rel="next" href="marine-mammals.html"/>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="assets/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="assets/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.0/anchor-sections.js"></script>
<script src="assets/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="assets/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="assets/datatables-binding-0.16/datatables.js"></script>
<link href="assets/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="assets/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="assets/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="assets/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="assets/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Building Gadget models</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this course</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-objectives"><i class="fa fa-check"></i><b>1.1</b> Course objectives</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#your-a-priori-homework"><i class="fa fa-check"></i><b>1.2</b> Your a priori homework</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#reading-material"><i class="fa fa-check"></i><b>1.3</b> Reading material</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html"><i class="fa fa-check"></i><b>2</b> General context of Gadget</a><ul>
<li class="chapter" data-level="2.1" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html#gadget-a-toolbox-for-fisheries-stock-assessments"><i class="fa fa-check"></i><b>2.1</b> Gadget – a toolbox for fisheries stock assessments</a></li>
<li class="chapter" data-level="2.2" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html#description-of-gadget"><i class="fa fa-check"></i><b>2.2</b> Description of Gadget</a></li>
<li class="chapter" data-level="2.3" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html#this-course"><i class="fa fa-check"></i><b>2.3</b> This course</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html"><i class="fa fa-check"></i><b>3</b> Introduction to Tidyverse</a><ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#idealogy-behind-r-for-data-science"><i class="fa fa-check"></i><b>3.1</b> Idealogy behind R for Data Science</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#the-foundation-tibbles-tidy-data-and-piping"><i class="fa fa-check"></i><b>3.2</b> The foundation: tibbles, tidy data, and piping</a><ul>
<li class="chapter" data-level="3.2.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#tibbles"><i class="fa fa-check"></i><b>3.2.1</b> Tibbles</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#tidy-data"><i class="fa fa-check"></i><b>3.3</b> Tidy data</a><ul>
<li class="chapter" data-level="3.3.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#piping"><i class="fa fa-check"></i><b>3.3.1</b> Piping</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#the-power-of-tidyverse-all-you-need-in-a-handful-of-functions"><i class="fa fa-check"></i><b>3.4</b> The power of tidyverse: all you need in a handful of functions</a></li>
<li class="chapter" data-level="3.5" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#plotting-in-tidyverse"><i class="fa fa-check"></i><b>3.5</b> Plotting in tidyverse</a><ul>
<li class="chapter" data-level="3.5.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#ggplot-key-components"><i class="fa fa-check"></i><b>3.5.1</b> ggplot: Key components</a></li>
<li class="chapter" data-level="3.5.2" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#aesthetic"><i class="fa fa-check"></i><b>3.5.2</b> aesthetic</a></li>
<li class="chapter" data-level="3.5.3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#facetting"><i class="fa fa-check"></i><b>3.5.3</b> Facetting</a></li>
<li class="chapter" data-level="3.5.4" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#adding-layers"><i class="fa fa-check"></i><b>3.5.4</b> Adding layers</a></li>
<li class="chapter" data-level="3.5.5" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#add-a-line-to-a-scatterplot"><i class="fa fa-check"></i><b>3.5.5</b> Add a line to a scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#statistical-summary-graphs"><i class="fa fa-check"></i><b>3.6</b> Statistical summary graphs</a></li>
<li class="chapter" data-level="3.7" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#other-statistical-summaries"><i class="fa fa-check"></i><b>3.7</b> Other statistical summaries</a></li>
<li class="chapter" data-level="3.8" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#some-controls"><i class="fa fa-check"></i><b>3.8</b> Some controls</a><ul>
<li class="chapter" data-level="3.8.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#labels"><i class="fa fa-check"></i><b>3.8.1</b> labels</a></li>
<li class="chapter" data-level="3.8.2" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#legend-position"><i class="fa fa-check"></i><b>3.8.2</b> Legend position</a></li>
<li class="chapter" data-level="3.8.3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#breaks"><i class="fa fa-check"></i><b>3.8.3</b> breaks</a></li>
<li class="chapter" data-level="3.8.4" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#limits"><i class="fa fa-check"></i><b>3.8.4</b> limits</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#further-readings"><i class="fa fa-check"></i><b>3.9</b> Further readings</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html"><i class="fa fa-check"></i><b>4</b> Getting started with the Gadget framework</a><ul>
<li class="chapter" data-level="4.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#what-is-rgadget"><i class="fa fa-check"></i><b>4.1</b> What is Rgadget?</a></li>
<li class="chapter" data-level="4.2" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#using-rgadget"><i class="fa fa-check"></i><b>4.2</b> Using Rgadget</a></li>
<li class="chapter" data-level="4.3" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#creating-model-input-files"><i class="fa fa-check"></i><b>4.3</b> Creating model input files</a><ul>
<li class="chapter" data-level="4.3.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#time-file"><i class="fa fa-check"></i><b>4.3.1</b> Time file</a></li>
<li class="chapter" data-level="4.3.2" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#area-file"><i class="fa fa-check"></i><b>4.3.2</b> Area file</a></li>
<li class="chapter" data-level="4.3.3" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#stockfiles"><i class="fa fa-check"></i><b>4.3.3</b> Stockfiles</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#starting-a-simulation"><i class="fa fa-check"></i><b>4.4</b> Starting a simulation</a></li>
<li class="chapter" data-level="4.5" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#gadget-variables"><i class="fa fa-check"></i><b>4.5</b> Gadget variables</a></li>
<li class="chapter" data-level="4.6" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#predation"><i class="fa fa-check"></i><b>4.6</b> Predation</a></li>
<li class="chapter" data-level="4.7" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#fleet-operations"><i class="fa fa-check"></i><b>4.7</b> Fleet operations</a><ul>
<li class="chapter" data-level="4.7.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#excercise"><i class="fa fa-check"></i><b>4.7.1</b> Excercise</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#recruitment"><i class="fa fa-check"></i><b>4.8</b> Recruitment</a><ul>
<li class="chapter" data-level="4.8.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#exercise-1"><i class="fa fa-check"></i><b>4.8.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html"><i class="fa fa-check"></i><b>5</b> Defining stock interations</a><ul>
<li class="chapter" data-level="5.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#fish-recruits-into-a-stock"><i class="fa fa-check"></i><b>5.1</b> Fish recruits into a stock</a><ul>
<li class="chapter" data-level="5.1.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#excercise-1"><i class="fa fa-check"></i><b>5.1.1</b> Excercise</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#spawning"><i class="fa fa-check"></i><b>5.2</b> Spawning</a><ul>
<li class="chapter" data-level="5.2.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#time-variables"><i class="fa fa-check"></i><b>5.2.1</b> Time variables</a></li>
<li class="chapter" data-level="5.2.2" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#excercise-2"><i class="fa fa-check"></i><b>5.2.2</b> Excercise</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#consumption"><i class="fa fa-check"></i><b>5.3</b> Consumption</a><ul>
<li class="chapter" data-level="5.3.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#excercise-3"><i class="fa fa-check"></i><b>5.3.1</b> Excercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html"><i class="fa fa-check"></i><b>6</b> Building complex Gadget models</a><ul>
<li class="chapter" data-level="6.1" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#defining-growth"><i class="fa fa-check"></i><b>6.1</b> Defining growth</a><ul>
<li class="chapter" data-level="6.1.1" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#growth"><i class="fa fa-check"></i><b>6.1.1</b> Growth</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#ling-stock-assessment-in-icelandic-waters"><i class="fa fa-check"></i><b>6.2</b> Ling stock assessment in Icelandic waters</a></li>
<li class="chapter" data-level="6.3" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#model-initiation"><i class="fa fa-check"></i><b>6.3</b> Model initiation</a><ul>
<li class="chapter" data-level="6.3.1" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#maturation-as-multi-stock-models"><i class="fa fa-check"></i><b>6.3.1</b> Maturation as multi-‘stock’ models</a></li>
<li class="chapter" data-level="6.3.2" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#initial-conditions"><i class="fa fa-check"></i><b>6.3.2</b> Initial conditions</a></li>
<li class="chapter" data-level="6.3.3" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#renewal"><i class="fa fa-check"></i><b>6.3.3</b> Renewal</a></li>
<li class="chapter" data-level="6.3.4" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#reference-weight"><i class="fa fa-check"></i><b>6.3.4</b> Reference Weight</a></li>
<li class="chapter" data-level="6.3.5" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#is-fished-eaten"><i class="fa fa-check"></i><b>6.3.5</b> Is fished / eaten</a></li>
<li class="chapter" data-level="6.3.6" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#set-up-fleets-using-catch-or-effort-data"><i class="fa fa-check"></i><b>6.3.6</b> Set up fleets using catch or effort data</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#run-the-simulation-using-pre-determined-parameters"><i class="fa fa-check"></i><b>6.4</b> Run the simulation using pre-determined parameters</a></li>
<li class="chapter" data-level="6.5" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#talking-points"><i class="fa fa-check"></i><b>6.5</b> Talking points</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html"><i class="fa fa-check"></i><b>7</b> Fitting a model to data</a><ul>
<li class="chapter" data-level="7.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#introducing-likelihood-functions"><i class="fa fa-check"></i><b>7.1</b> Introducing likelihood functions</a></li>
<li class="chapter" data-level="7.2" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#incorporating-data-ling-case-study-cont."><i class="fa fa-check"></i><b>7.2</b> Incorporating data (Ling case study cont.)</a><ul>
<li class="chapter" data-level="7.2.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#exercise-3"><i class="fa fa-check"></i><b>7.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#setting-up-likelihood-components"><i class="fa fa-check"></i><b>7.3</b> Setting up likelihood components</a><ul>
<li class="chapter" data-level="7.3.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#setting-up-survey-indices"><i class="fa fa-check"></i><b>7.3.1</b> Setting up survey indices</a></li>
<li class="chapter" data-level="7.3.2" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#penalty-functions"><i class="fa fa-check"></i><b>7.3.2</b> Penalty functions</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#fitting-a-gadget-model-to-data"><i class="fa fa-check"></i><b>7.4</b> Fitting a Gadget model to data</a><ul>
<li class="chapter" data-level="7.4.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#create-starting-values"><i class="fa fa-check"></i><b>7.4.1</b> Create starting values</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#set-optimisation-routine"><i class="fa fa-check"></i><b>7.5</b> Set optimisation routine</a></li>
<li class="chapter" data-level="7.6" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#using-the-iterative-reweighting-function-to-fit-a-gadget-statistical-model"><i class="fa fa-check"></i><b>7.6</b> Using the iterative reweighting function to fit a Gadget statistical model</a></li>
<li class="chapter" data-level="7.7" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#visualize-gadget-statistical-model-fit"><i class="fa fa-check"></i><b>7.7</b> Visualize Gadget statistical model fit</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html"><i class="fa fa-check"></i><b>8</b> Defining multi area models</a><ul>
<li class="chapter" data-level="8.1" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html#alternate-structures-multiple-areas"><i class="fa fa-check"></i><b>8.1</b> Alternate structures: multiple areas</a><ul>
<li class="chapter" data-level="8.1.1" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html#migration"><i class="fa fa-check"></i><b>8.1.1</b> Migration</a></li>
<li class="chapter" data-level="8.1.2" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html#using-data-from-multiple-areas"><i class="fa fa-check"></i><b>8.1.2</b> Using data from multiple areas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="marine-mammals.html"><a href="marine-mammals.html"><i class="fa fa-check"></i><b>9</b> Marine mammals</a></li>
<li class="chapter" data-level="10" data-path="setting-up-a-model-for-a-hypothetical-whale-stock.html"><a href="setting-up-a-model-for-a-hypothetical-whale-stock.html"><i class="fa fa-check"></i><b>10</b> Setting up a model for a hypothetical whale stock</a><ul>
<li class="chapter" data-level="10.0.1" data-path="setting-up-a-model-for-a-hypothetical-whale-stock.html"><a href="setting-up-a-model-for-a-hypothetical-whale-stock.html#run-gadget-and-set-initial-parameters"><i class="fa fa-check"></i><b>10.0.1</b> Run Gadget and set initial parameters</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html"><i class="fa fa-check"></i><b>11</b> Processing input data with MFDB</a><ul>
<li class="chapter" data-level="11.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#working-with-data"><i class="fa fa-check"></i><b>11.1</b> Working with data</a></li>
<li class="chapter" data-level="11.2" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#description-of-the-mfdb-system"><i class="fa fa-check"></i><b>11.2</b> Description of the MFDB system</a><ul>
<li class="chapter" data-level="11.2.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#installing-mfdb"><i class="fa fa-check"></i><b>11.2.1</b> Installing MFDB</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#importing-data"><i class="fa fa-check"></i><b>11.3</b> Importing data</a><ul>
<li class="chapter" data-level="11.3.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#connect-to-database"><i class="fa fa-check"></i><b>11.3.1</b> Connect to database</a></li>
<li class="chapter" data-level="11.3.2" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#defining-taxonomies"><i class="fa fa-check"></i><b>11.3.2</b> Defining taxonomies</a></li>
<li class="chapter" data-level="11.3.3" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-areas-divisions"><i class="fa fa-check"></i><b>11.3.3</b> Define areas &amp; divisions</a></li>
<li class="chapter" data-level="11.3.4" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-sampling-types"><i class="fa fa-check"></i><b>11.3.4</b> Define sampling types</a></li>
<li class="chapter" data-level="11.3.5" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-vessel-taxonomy"><i class="fa fa-check"></i><b>11.3.5</b> Define vessel taxonomy</a></li>
<li class="chapter" data-level="11.3.6" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-tow-taxonomy"><i class="fa fa-check"></i><b>11.3.6</b> Define tow taxonomy</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#importing-data-1"><i class="fa fa-check"></i><b>11.4</b> Importing data</a><ul>
<li class="chapter" data-level="11.4.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#import-temperature-data"><i class="fa fa-check"></i><b>11.4.1</b> Import temperature data</a></li>
<li class="chapter" data-level="11.4.2" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#importing-surveycommercial-samples"><i class="fa fa-check"></i><b>11.4.2</b> Importing survey/commercial samples</a></li>
<li class="chapter" data-level="11.4.3" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#import-stomach-survey"><i class="fa fa-check"></i><b>11.4.3</b> Import stomach survey</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#querying-data"><i class="fa fa-check"></i><b>11.5</b> Querying data</a></li>
<li class="chapter" data-level="11.6" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#uploading-the-datras-database-to-mfdb"><i class="fa fa-check"></i><b>11.6</b> Uploading the DATRAS database to MFDB</a></li>
<li class="chapter" data-level="11.7" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#dumping-restoring-a-db"><i class="fa fa-check"></i><b>11.7</b> Dumping / Restoring a DB</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html"><i class="fa fa-check"></i><b>A</b> Installing Gadget from source</a><ul>
<li class="chapter" data-level="A.1" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#command-line-version"><i class="fa fa-check"></i><b>A.1</b> Command line version</a><ul>
<li class="chapter" data-level="A.1.1" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#linux"><i class="fa fa-check"></i><b>A.1.1</b> Linux</a></li>
<li class="chapter" data-level="A.1.2" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#mac"><i class="fa fa-check"></i><b>A.1.2</b> Mac</a></li>
<li class="chapter" data-level="A.1.3" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#windows"><i class="fa fa-check"></i><b>A.1.3</b> Windows</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#download-compile-and-install"><i class="fa fa-check"></i><b>A.2</b> Download, compile and install</a><ul>
<li class="chapter" data-level="A.2.1" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#standard-procedure"><i class="fa fa-check"></i><b>A.2.1</b> Standard procedure</a></li>
<li class="chapter" data-level="A.2.2" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#recommended-via-git"><i class="fa fa-check"></i><b>A.2.2</b> Recommended: via Git</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html"><i class="fa fa-check"></i><b>B</b> Troubleshooting Gadget models</a><ul>
<li class="chapter" data-level="B.0.1" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#file-data-gadget-cannot-be-found"><i class="fa fa-check"></i><b>B.0.1</b> File / data / Gadget cannot be found</a></li>
<li class="chapter" data-level="B.0.2" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#fleet-data-likelihood-problems"><i class="fa fa-check"></i><b>B.0.2</b> Fleet / Data / Likelihood problems</a></li>
<li class="chapter" data-level="B.0.3" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#starting-value-is-outside-the-bounds-of-the-parameter"><i class="fa fa-check"></i><b>B.0.3</b> Starting value is outside the bounds of the parameter</a></li>
<li class="chapter" data-level="B.0.4" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#update-gadget-and-rgadget-restart-the-rsession"><i class="fa fa-check"></i><b>B.0.4</b> Update Gadget and Rgadget, restart the Rsession</a></li>
<li class="chapter" data-level="B.1" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#list-of-known-gadget-quirks"><i class="fa fa-check"></i><b>B.1</b> List of known Gadget quirks</a></li>
<li class="chapter" data-level="B.2" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#gadget-is-working-properly-but-results-are-strange"><i class="fa fa-check"></i><b>B.2</b> Gadget is working properly, but results are strange</a><ul>
<li class="chapter" data-level="B.2.1" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#programming-errors"><i class="fa fa-check"></i><b>B.2.1</b> Programming errors</a></li>
<li class="chapter" data-level="B.2.2" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#old-files-hanging-around-in-the-gadget-model-directory"><i class="fa fa-check"></i><b>B.2.2</b> Old files hanging around in the Gadget model directory</a></li>
<li class="chapter" data-level="B.2.3" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#gadget-iterative-gives-errors"><i class="fa fa-check"></i><b>B.2.3</b> Gadget iterative gives errors</a></li>
<li class="chapter" data-level="B.2.4" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#the-gadget-working-directory-is-incorporating-files-from-another-gadget-model"><i class="fa fa-check"></i><b>B.2.4</b> The Gadget working directory is incorporating files from another Gadget model</a></li>
<li class="chapter" data-level="B.2.5" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#your-model-is-not-good"><i class="fa fa-check"></i><b>B.2.5</b> Your model is not good</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>C</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Building models using the Gadget framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="defining-multi-area-models" class="section level1">
<h1><span class="header-section-number">8</span> Defining multi area models</h1>
<div id="alternate-structures-multiple-areas" class="section level2">
<h2><span class="header-section-number">8.1</span> Alternate structures: multiple areas</h2>
<p>Let’s return to the initial set-up of the ling model and modify it such that
the stock live on two areas. The first step to do this is to modify the area
file and stock files to include a second area.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="defining-multi-area-models.html#cb314-1"></a><span class="kw">library</span>(Rgadget)</span>
<span id="cb314-2"><a href="defining-multi-area-models.html#cb314-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb314-3"><a href="defining-multi-area-models.html#cb314-3"></a></span>
<span id="cb314-4"><a href="defining-multi-area-models.html#cb314-4"></a><span class="co">#assuming you are beginning in a fresh session; this information should be in an </span></span>
<span id="cb314-5"><a href="defining-multi-area-models.html#cb314-5"></a><span class="co">#initialization script</span></span>
<span id="cb314-6"><a href="defining-multi-area-models.html#cb314-6"></a></span>
<span id="cb314-7"><a href="defining-multi-area-models.html#cb314-7"></a>base_dir &lt;-<span class="st"> &#39;ling_model&#39;</span></span>
<span id="cb314-8"><a href="defining-multi-area-models.html#cb314-8"></a>vers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;01-base&#39;</span>)</span>
<span id="cb314-9"><a href="defining-multi-area-models.html#cb314-9"></a>gd &lt;-<span class="st"> </span><span class="kw">gadget.variant.dir</span>(<span class="kw">sprintf</span>(<span class="kw">paste0</span>(<span class="st">&quot;%s/&quot;</span>,vers),base_dir))</span>
<span id="cb314-10"><a href="defining-multi-area-models.html#cb314-10"></a></span>
<span id="cb314-11"><a href="defining-multi-area-models.html#cb314-11"></a>ling.imm &lt;-<span class="st"> </span><span class="kw">gadgetstock</span>(<span class="st">&#39;lingimm&#39;</span>,gd)</span>
<span id="cb314-12"><a href="defining-multi-area-models.html#cb314-12"></a>ling.mat &lt;-<span class="st"> </span><span class="kw">gadgetstock</span>(<span class="st">&#39;lingmat&#39;</span>,gd)</span>
<span id="cb314-13"><a href="defining-multi-area-models.html#cb314-13"></a><span class="co">#area_file &lt;- read.gadget.file(gd, &#39;Modelfiles/area&#39;, file_type = &#39;area&#39;)</span></span>
<span id="cb314-14"><a href="defining-multi-area-models.html#cb314-14"></a></span>
<span id="cb314-15"><a href="defining-multi-area-models.html#cb314-15"></a><span class="co">## Write out areafile and update mainfile with areafile location</span></span>
<span id="cb314-16"><a href="defining-multi-area-models.html#cb314-16"></a></span>
<span id="cb314-17"><a href="defining-multi-area-models.html#cb314-17"></a>schedule &lt;-<span class="st"> </span></span>
<span id="cb314-18"><a href="defining-multi-area-models.html#cb314-18"></a><span class="st">  </span><span class="kw">expand.grid</span>(<span class="dt">year =</span> <span class="dv">1982</span><span class="op">:</span><span class="dv">2018</span>, <span class="dt">step =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">area =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb314-19"><a href="defining-multi-area-models.html#cb314-19"></a><span class="st">  </span><span class="kw">arrange</span>(year, step, area)</span>
<span id="cb314-20"><a href="defining-multi-area-models.html#cb314-20"></a></span>
<span id="cb314-21"><a href="defining-multi-area-models.html#cb314-21"></a>area_file &lt;-<span class="st"> </span></span>
<span id="cb314-22"><a href="defining-multi-area-models.html#cb314-22"></a><span class="st">  </span><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/area&#39;</span>,</span>
<span id="cb314-23"><a href="defining-multi-area-models.html#cb314-23"></a>             <span class="dt">file_type =</span> <span class="st">&#39;area&#39;</span>,</span>
<span id="cb314-24"><a href="defining-multi-area-models.html#cb314-24"></a>             <span class="dt">components =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">areas =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb314-25"><a href="defining-multi-area-models.html#cb314-25"></a>                                    <span class="dt">size =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb314-26"><a href="defining-multi-area-models.html#cb314-26"></a>                                    <span class="dt">temperature=</span> schedule <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">temperature =</span> <span class="dv">5</span>)))) </span>
<span id="cb314-27"><a href="defining-multi-area-models.html#cb314-27"></a>area_file <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb314-28"><a href="defining-multi-area-models.html#cb314-28"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb314-29"><a href="defining-multi-area-models.html#cb314-29"></a></span>
<span id="cb314-30"><a href="defining-multi-area-models.html#cb314-30"></a>ling.imm &lt;-</span>
<span id="cb314-31"><a href="defining-multi-area-models.html#cb314-31"></a><span class="st">  </span>ling.imm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb314-32"><a href="defining-multi-area-models.html#cb314-32"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb314-33"><a href="defining-multi-area-models.html#cb314-33"></a>                <span class="dt">livesonareas =</span> area_file[[<span class="dv">1</span>]]<span class="op">$</span>areas)  </span>
<span id="cb314-34"><a href="defining-multi-area-models.html#cb314-34"></a>ling.mat &lt;-<span class="st"> </span></span>
<span id="cb314-35"><a href="defining-multi-area-models.html#cb314-35"></a><span class="st">  </span>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb314-36"><a href="defining-multi-area-models.html#cb314-36"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb314-37"><a href="defining-multi-area-models.html#cb314-37"></a>                <span class="dt">livesonareas =</span> area_file[[<span class="dv">1</span>]]<span class="op">$</span>areas)  </span>
<span id="cb314-38"><a href="defining-multi-area-models.html#cb314-38"></a></span>
<span id="cb314-39"><a href="defining-multi-area-models.html#cb314-39"></a>ling.imm</span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## stockname    lingimm
## livesonareas 1   2
## minage   3
## maxage   10
## minlength    20
## maxlength    160
## dl   4
## refweightfile    Modelfiles/lingimm.refwgt
## growthandeatlengths  Aggfiles/lingimm.stock.len.agg
## doesgrow 1
## growthfunction   lengthvbsimple
## growthparameters #ling.Linf  (* 0.001 #ling.k)   #ling.walpha    #ling.wbeta
## beta (* 10 #ling.bbin)
## maxlengthgroupgrowth 15
## naturalmortality #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M
## iseaten  1
## preylengths  Aggfiles/lingimm.stock.len.agg
## energycontent    1
## doeseat  0
## initialconditions
## minage   3
## maxage   10
## minlength    20
## maxlength    160
## dl   4
## normalparamfile  Modelfiles/lingimm.init.normalparam
## doesmigrate  0
## doesmature   1
## maturityfunction continuous
## maturityfile Modelfiles/lingimm.maturity
## doesmove 1
## transitionstocksandratios    lingmat 1
## transitionstep   4
## doesrenew    1
## minlength    20
## maxlength    160
## dl   4
## normalparamfile  Modelfiles/lingimm.rec.normalparam
## doesspawn    0
## doesstray    0</code></pre>
<p>In theory, the only details left that are necessary to set up a two-area model
is to provide initial values and recruitment, as these are designated both by
area and age combinations:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="defining-multi-area-models.html#cb316-1"></a><span class="co">#taken from data analyses</span></span>
<span id="cb316-2"><a href="defining-multi-area-models.html#cb316-2"></a>init.sigma.i &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">2</span>, <span class="kw">length</span>(ling.imm[[<span class="dv">1</span>]]<span class="op">$</span>minage<span class="op">:</span>ling.imm[[<span class="dv">1</span>]]<span class="op">$</span>maxage))</span>
<span id="cb316-3"><a href="defining-multi-area-models.html#cb316-3"></a>init.sigma.m &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">2</span>, <span class="kw">length</span>(ling.mat[[<span class="dv">1</span>]]<span class="op">$</span>minage<span class="op">:</span>ling.mat[[<span class="dv">1</span>]]<span class="op">$</span>maxage))</span>
<span id="cb316-4"><a href="defining-multi-area-models.html#cb316-4"></a></span>
<span id="cb316-5"><a href="defining-multi-area-models.html#cb316-5"></a>ling.imm &lt;-</span>
<span id="cb316-6"><a href="defining-multi-area-models.html#cb316-6"></a><span class="st">  </span>ling.imm <span class="op">%&gt;%</span></span>
<span id="cb316-7"><a href="defining-multi-area-models.html#cb316-7"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb316-8"><a href="defining-multi-area-models.html#cb316-8"></a>                <span class="dt">normalparam =</span> </span>
<span id="cb316-9"><a href="defining-multi-area-models.html#cb316-9"></a>                  <span class="kw">expand.grid</span>(<span class="dt">age =</span> ling.imm[[<span class="dv">1</span>]]<span class="op">$</span>minage<span class="op">:</span>ling.imm[[<span class="dv">1</span>]]<span class="op">$</span>maxage, <span class="dt">area =</span> area_file[[<span class="dv">1</span>]]<span class="op">$</span>areas) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-10"><a href="defining-multi-area-models.html#cb316-10"></a><span class="st">                  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-11"><a href="defining-multi-area-models.html#cb316-11"></a><span class="st">                  </span><span class="kw">mutate</span>( </span>
<span id="cb316-12"><a href="defining-multi-area-models.html#cb316-12"></a>                    <span class="dt">age.factor =</span> <span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">sprintf</span>(<span class="st">&#39;exp(-1*(lingimm.M+ling.init.F)*%1$s)*lingimm.init.%1$s&#39;</span>,age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-13"><a href="defining-multi-area-models.html#cb316-13"></a><span class="st">                      </span><span class="kw">map</span>(to.gadget.formulae) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-14"><a href="defining-multi-area-models.html#cb316-14"></a><span class="st">                      </span><span class="kw">unlist</span>(),   </span>
<span id="cb316-15"><a href="defining-multi-area-models.html#cb316-15"></a>                    <span class="dt">area.factor =</span> <span class="st">&#39;#lingimm.init.scalar&#39;</span>,</span>
<span id="cb316-16"><a href="defining-multi-area-models.html#cb316-16"></a>                    <span class="dt">mean =</span> <span class="kw">von_b_formula</span>(age,<span class="dt">linf=</span><span class="st">&#39;ling.Linf&#39;</span>,<span class="dt">k=</span><span class="st">&#39;ling.k&#39;</span>,<span class="dt">recl=</span><span class="st">&#39;ling.recl&#39;</span>),</span>
<span id="cb316-17"><a href="defining-multi-area-models.html#cb316-17"></a>                    <span class="dt">stddev =</span> <span class="kw">rep</span>(init.sigma.i,<span class="dv">2</span>),</span>
<span id="cb316-18"><a href="defining-multi-area-models.html#cb316-18"></a>                    <span class="dt">alpha =</span> <span class="st">&#39;#ling.walpha&#39;</span>,</span>
<span id="cb316-19"><a href="defining-multi-area-models.html#cb316-19"></a>                    <span class="dt">beta =</span> <span class="st">&#39;#ling.wbeta&#39;</span></span>
<span id="cb316-20"><a href="defining-multi-area-models.html#cb316-20"></a>                    )</span>
<span id="cb316-21"><a href="defining-multi-area-models.html#cb316-21"></a>                ) <span class="op">%&gt;%</span></span>
<span id="cb316-22"><a href="defining-multi-area-models.html#cb316-22"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesrenew&#39;</span>,</span>
<span id="cb316-23"><a href="defining-multi-area-models.html#cb316-23"></a>                <span class="dt">normalparam =</span> </span>
<span id="cb316-24"><a href="defining-multi-area-models.html#cb316-24"></a>                  <span class="kw">expand.grid</span>(<span class="dt">year =</span> schedule<span class="op">$</span>year,<span class="dt">area =</span> area_file[[<span class="dv">1</span>]]<span class="op">$</span>areas) <span class="op">%&gt;%</span></span>
<span id="cb316-25"><a href="defining-multi-area-models.html#cb316-25"></a><span class="st">                  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-26"><a href="defining-multi-area-models.html#cb316-26"></a><span class="st">                  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-27"><a href="defining-multi-area-models.html#cb316-27"></a><span class="st">                  </span><span class="kw">mutate</span>(<span class="dt">step =</span> <span class="dv">1</span>,</span>
<span id="cb316-28"><a href="defining-multi-area-models.html#cb316-28"></a>                         <span class="dt">age =</span> ling.imm[[<span class="dv">1</span>]]<span class="op">$</span>minage,</span>
<span id="cb316-29"><a href="defining-multi-area-models.html#cb316-29"></a>                         <span class="dt">number =</span> <span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">sprintf</span>(<span class="st">&#39;ling.rec.scalar*ling.rec.%s&#39;</span>,year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-30"><a href="defining-multi-area-models.html#cb316-30"></a><span class="st">                           </span><span class="kw">map</span>(to.gadget.formulae) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-31"><a href="defining-multi-area-models.html#cb316-31"></a><span class="st">                           </span><span class="kw">unlist</span>(),</span>
<span id="cb316-32"><a href="defining-multi-area-models.html#cb316-32"></a>                         <span class="dt">mean =</span> <span class="kw">von_b_formula</span>(age,<span class="dt">linf=</span><span class="st">&#39;ling.Linf&#39;</span>,<span class="dt">k=</span><span class="st">&#39;ling.k&#39;</span>,<span class="dt">recl=</span><span class="st">&#39;ling.recl&#39;</span>),</span>
<span id="cb316-33"><a href="defining-multi-area-models.html#cb316-33"></a>                         <span class="dt">stddev =</span> <span class="st">&#39;#ling.rec.sd&#39;</span>,</span>
<span id="cb316-34"><a href="defining-multi-area-models.html#cb316-34"></a>                         <span class="dt">alpha =</span> <span class="st">&#39;#ling.walpha&#39;</span>,</span>
<span id="cb316-35"><a href="defining-multi-area-models.html#cb316-35"></a>                         <span class="dt">beta =</span> <span class="st">&#39;#ling.wbeta&#39;</span></span>
<span id="cb316-36"><a href="defining-multi-area-models.html#cb316-36"></a>                         )</span>
<span id="cb316-37"><a href="defining-multi-area-models.html#cb316-37"></a>                ) </span>
<span id="cb316-38"><a href="defining-multi-area-models.html#cb316-38"></a></span>
<span id="cb316-39"><a href="defining-multi-area-models.html#cb316-39"></a>ling.mat &lt;-</span>
<span id="cb316-40"><a href="defining-multi-area-models.html#cb316-40"></a><span class="st">  </span>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-41"><a href="defining-multi-area-models.html#cb316-41"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb316-42"><a href="defining-multi-area-models.html#cb316-42"></a>                <span class="dt">normalparam =</span> <span class="kw">expand.grid</span>(<span class="dt">age =</span> ling.mat[[<span class="dv">1</span>]]<span class="op">$</span>minage<span class="op">:</span>ling.mat[[<span class="dv">1</span>]]<span class="op">$</span>maxage, <span class="dt">area =</span> area_file[[<span class="dv">1</span>]]<span class="op">$</span>areas) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-43"><a href="defining-multi-area-models.html#cb316-43"></a><span class="st">                  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-44"><a href="defining-multi-area-models.html#cb316-44"></a><span class="st">                  </span><span class="kw">mutate</span>(</span>
<span id="cb316-45"><a href="defining-multi-area-models.html#cb316-45"></a>                    <span class="dt">age.factor =</span> <span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">sprintf</span>(<span class="st">&#39;exp(-1*(lingmat.M+ling.init.F)*%1$s)*lingmat.init.%1$s&#39;</span>,age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-46"><a href="defining-multi-area-models.html#cb316-46"></a><span class="st">                      </span><span class="kw">map</span>(to.gadget.formulae) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-47"><a href="defining-multi-area-models.html#cb316-47"></a><span class="st">                      </span><span class="kw">unlist</span>(),</span>
<span id="cb316-48"><a href="defining-multi-area-models.html#cb316-48"></a>                    <span class="dt">area.factor =</span> <span class="st">&#39;#lingmat.init.scalar&#39;</span>,</span>
<span id="cb316-49"><a href="defining-multi-area-models.html#cb316-49"></a>                    <span class="dt">mean =</span> <span class="kw">von_b_formula</span>(age,<span class="dt">linf=</span><span class="st">&#39;ling.Linf&#39;</span>,<span class="dt">k=</span><span class="st">&#39;ling.k&#39;</span>,<span class="dt">recl=</span><span class="st">&#39;ling.recl&#39;</span>),</span>
<span id="cb316-50"><a href="defining-multi-area-models.html#cb316-50"></a>                    <span class="dt">stddev =</span> <span class="kw">rep</span>(init.sigma.m,<span class="dv">2</span>),</span>
<span id="cb316-51"><a href="defining-multi-area-models.html#cb316-51"></a>                    <span class="dt">alpha =</span> <span class="st">&#39;#lingmat.walpha&#39;</span>,</span>
<span id="cb316-52"><a href="defining-multi-area-models.html#cb316-52"></a>                    <span class="dt">beta =</span> <span class="st">&#39;#lingmat.wbeta&#39;</span></span>
<span id="cb316-53"><a href="defining-multi-area-models.html#cb316-53"></a>                    )</span>
<span id="cb316-54"><a href="defining-multi-area-models.html#cb316-54"></a>                )  </span>
<span id="cb316-55"><a href="defining-multi-area-models.html#cb316-55"></a><span class="co">## write to file</span></span>
<span id="cb316-56"><a href="defining-multi-area-models.html#cb316-56"></a>ling.imm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-57"><a href="defining-multi-area-models.html#cb316-57"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb316-58"><a href="defining-multi-area-models.html#cb316-58"></a></span>
<span id="cb316-59"><a href="defining-multi-area-models.html#cb316-59"></a>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb316-60"><a href="defining-multi-area-models.html#cb316-60"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<p>The only changes added to the above model were to add a second area with the
same exact values in initial conditions and recruitment as found in the
previous model with only a single area. The second area is therefore a
simulated mirror of the first, but with no fishing, as the fleets only
exist on area 1. Structurally, this is the minimum possible information
needed to include a second area.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="defining-multi-area-models.html#cb317-1"></a><span class="kw">gadget_evaluate</span>(gd,<span class="dt">log =</span> <span class="st">&#39;log_area2&#39;</span>)</span></code></pre></div>
<div id="migration" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Migration</h3>
<p>A model as shown in the previous section may be useful for theoretical
simulations, otherwise it is not particularly interesting, and has no
effect on what goes on in area 1, including the model fitting procedures
(as data are specified by area). A slightly more interesting model could
be a single population in two areas that can interact between areas
via migration, which determines how much the individuals move among areas.</p>
<p>Migration is specified in the stock file under the migration section,
and is therefore updated first by indicating that migration exists by
turning the <code>doesmigrate</code> option from 0 to 1, and providing a migration
matrix or migration ratios (two forms of the same information). In Rgadget,
this can be done by creating a migration matrix file and using
<code>gadget_update</code> to modify the migration component of the stock file to
refer to this file.</p>
<p>A migration matrix is a square n x n matrix for the n areas that the stock
is defined on with proportions moving <em>from</em> each area given in columns
<em>to</em> the area given in rows. Migration should not change the total number
of fish in the model, so each column in the migration matrix should
sum to 1. Therefore in the following example, at the start of migration,
60% of individuals in area 1 remain there, 40% move to area 2. Likewise,
30% of individuals in area 2 move to area 1, whereas 70% remain there:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="defining-multi-area-models.html#cb318-1"></a><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.7</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]  0.6  0.3
## [2,]  0.4  0.7</code></pre>
<p>An alternate method for supplying these values is via migration ratios,
which instead lists only the proportions of fish moving, and lets Gadget
calculate the full matrix from those. To represent the above matrix in
this form, we would write:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="defining-multi-area-models.html#cb320-1"></a><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="fl">0.4</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="fl">0.3</span>), <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> T)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2  0.4
## [2,]    2    1  0.3</code></pre>
<p>In this form, within each row, the first column shows the origin area, the second the
destination area, and the third the proportion. Note that migrations of 0% are calculated
automatically, so they should be omitted.</p>
<p>In this example we continue with the migration ratios format. Ratios can be replaced with
switches that are specified in the parameters file, and the matrix can
be placed into a Gadget file with the necessary name and keyword
<code>[migrationmatrix]</code> using <code>gadgetfile</code>:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="defining-multi-area-models.html#cb322-1"></a>tmp.mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="fl">0.4</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="st">&#39;#mig&#39;</span>), <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> T)</span>
<span id="cb322-2"><a href="defining-multi-area-models.html#cb322-2"></a></span>
<span id="cb322-3"><a href="defining-multi-area-models.html#cb322-3"></a><span class="co">#produce a migration matrix</span></span>
<span id="cb322-4"><a href="defining-multi-area-models.html#cb322-4"></a></span>
<span id="cb322-5"><a href="defining-multi-area-models.html#cb322-5"></a>    <span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/migration&#39;</span>,</span>
<span id="cb322-6"><a href="defining-multi-area-models.html#cb322-6"></a>                 <span class="dt">components =</span> <span class="kw">list</span>(<span class="dt">migrationmatrix =</span> <span class="kw">list</span>(</span>
<span id="cb322-7"><a href="defining-multi-area-models.html#cb322-7"></a>                                        <span class="dt">name =</span> <span class="st">&#39;test&#39;</span>,</span>
<span id="cb322-8"><a href="defining-multi-area-models.html#cb322-8"></a>                                        <span class="kw">as.list</span>(tmp.mat[<span class="dv">1</span>,]),</span>
<span id="cb322-9"><a href="defining-multi-area-models.html#cb322-9"></a>                                        <span class="kw">as.list</span>(tmp.mat[<span class="dv">2</span>,])</span>
<span id="cb322-10"><a href="defining-multi-area-models.html#cb322-10"></a>                                        )</span>
<span id="cb322-11"><a href="defining-multi-area-models.html#cb322-11"></a>                                   ) </span>
<span id="cb322-12"><a href="defining-multi-area-models.html#cb322-12"></a>    )</span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## [migrationmatrix]
## name test
##  1   2   0.4
##  2   1   #mig</code></pre>
<p>Each migration file can include a series of migrations, but note that the order of evaluation of
these affects the ratios that should be written. For example, suppose we have 1000 fish in
each area, and we want to represent the situation that 30% of the fish in area 1 will move to area 2 in time
step 1, and the same ratio will migrate to area 1 from 2 in time step 2. We would write
the following:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="defining-multi-area-models.html#cb324-1"></a>tmp.mat.w &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="fl">0.3</span>), <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">byrow =</span> T)</span>
<span id="cb324-2"><a href="defining-multi-area-models.html#cb324-2"></a>tmp.mat.e &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="fl">0.3</span>), <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">byrow =</span> T)</span>
<span id="cb324-3"><a href="defining-multi-area-models.html#cb324-3"></a></span>
<span id="cb324-4"><a href="defining-multi-area-models.html#cb324-4"></a>mig_file &lt;-</span>
<span id="cb324-5"><a href="defining-multi-area-models.html#cb324-5"></a><span class="st">    </span><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/migration&#39;</span>,</span>
<span id="cb324-6"><a href="defining-multi-area-models.html#cb324-6"></a>                 <span class="dt">components =</span> <span class="kw">list</span>(<span class="dt">migrationmatrix =</span> <span class="kw">list</span>(</span>
<span id="cb324-7"><a href="defining-multi-area-models.html#cb324-7"></a>                                        <span class="dt">name =</span> <span class="st">&#39;west&#39;</span>,</span>
<span id="cb324-8"><a href="defining-multi-area-models.html#cb324-8"></a>                                        <span class="kw">as.list</span>(tmp.mat.w[<span class="dv">1</span>,])</span>
<span id="cb324-9"><a href="defining-multi-area-models.html#cb324-9"></a>                                        ),</span>
<span id="cb324-10"><a href="defining-multi-area-models.html#cb324-10"></a>                                   <span class="dt">migrationmatrix =</span><span class="kw">list</span>(</span>
<span id="cb324-11"><a href="defining-multi-area-models.html#cb324-11"></a>                                        <span class="dt">name =</span> <span class="st">&#39;east&#39;</span>,</span>
<span id="cb324-12"><a href="defining-multi-area-models.html#cb324-12"></a>                                        <span class="kw">as.list</span>(tmp.mat.e[<span class="dv">1</span>,])</span>
<span id="cb324-13"><a href="defining-multi-area-models.html#cb324-13"></a>                                        )</span>
<span id="cb324-14"><a href="defining-multi-area-models.html#cb324-14"></a>                                   )</span>
<span id="cb324-15"><a href="defining-multi-area-models.html#cb324-15"></a>               )</span>
<span id="cb324-16"><a href="defining-multi-area-models.html#cb324-16"></a></span>
<span id="cb324-17"><a href="defining-multi-area-models.html#cb324-17"></a>mig_file    </span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## [migrationmatrix]
## name west
##  1   2   0.3
## [migrationmatrix]
## name east
##  2   1   0.3</code></pre>
<p>This indicates that 300 fish will move from area 1 to 2 in step 1, and then subsequently
0.3 x 1300 = 390 fish will move from area 2 to area 1. It does <em>not</em> mean that 300 fish
will move back, or that these fish are the same individuals that moved in step 1. For
this pattern a different model structure (with a new stock) is needed, so
that those 300 individuals can be tracked separately.</p>
<p>For our purposes, let’s set the migration proportions to switches:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="defining-multi-area-models.html#cb326-1"></a>tmp.mat.w &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="st">&#39;#ling.mig.w&#39;</span>), <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">byrow =</span> T)</span>
<span id="cb326-2"><a href="defining-multi-area-models.html#cb326-2"></a>tmp.mat.e &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="st">&#39;#ling.mig.e&#39;</span>), <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">byrow =</span> T)</span>
<span id="cb326-3"><a href="defining-multi-area-models.html#cb326-3"></a></span>
<span id="cb326-4"><a href="defining-multi-area-models.html#cb326-4"></a>mig_file &lt;-</span>
<span id="cb326-5"><a href="defining-multi-area-models.html#cb326-5"></a><span class="st">    </span><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/migration&#39;</span>,</span>
<span id="cb326-6"><a href="defining-multi-area-models.html#cb326-6"></a>                 <span class="dt">components =</span> <span class="kw">list</span>(<span class="dt">migrationmatrix =</span> <span class="kw">list</span>(</span>
<span id="cb326-7"><a href="defining-multi-area-models.html#cb326-7"></a>                                        <span class="dt">name =</span> <span class="st">&#39;west&#39;</span>,</span>
<span id="cb326-8"><a href="defining-multi-area-models.html#cb326-8"></a>                                        <span class="kw">as.list</span>(tmp.mat.w[<span class="dv">1</span>,])</span>
<span id="cb326-9"><a href="defining-multi-area-models.html#cb326-9"></a>                                        ),</span>
<span id="cb326-10"><a href="defining-multi-area-models.html#cb326-10"></a>                                   <span class="dt">migrationmatrix =</span><span class="kw">list</span>(</span>
<span id="cb326-11"><a href="defining-multi-area-models.html#cb326-11"></a>                                        <span class="dt">name =</span> <span class="st">&#39;east&#39;</span>,</span>
<span id="cb326-12"><a href="defining-multi-area-models.html#cb326-12"></a>                                        <span class="kw">as.list</span>(tmp.mat.e[<span class="dv">1</span>,])</span>
<span id="cb326-13"><a href="defining-multi-area-models.html#cb326-13"></a>                                        )</span>
<span id="cb326-14"><a href="defining-multi-area-models.html#cb326-14"></a>                                   )</span>
<span id="cb326-15"><a href="defining-multi-area-models.html#cb326-15"></a>               )</span>
<span id="cb326-16"><a href="defining-multi-area-models.html#cb326-16"></a></span>
<span id="cb326-17"><a href="defining-multi-area-models.html#cb326-17"></a>mig_file <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb326-18"><a href="defining-multi-area-models.html#cb326-18"></a><span class="st">      </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb326-19"><a href="defining-multi-area-models.html#cb326-19"></a></span>
<span id="cb326-20"><a href="defining-multi-area-models.html#cb326-20"></a>mig_file    </span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## [migrationmatrix]
## name west
##  1   2   #ling.mig.w
## [migrationmatrix]
## name east
##  2   1   #ling.mig.e</code></pre>
<p>Although in the above example we have time steps for migration in mind, we have not yet
designated them in a Gadget file. To do this, the next step is to create a migration timing file:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="defining-multi-area-models.html#cb328-1"></a>    <span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/migrationtime&#39;</span>,</span>
<span id="cb328-2"><a href="defining-multi-area-models.html#cb328-2"></a>               <span class="dt">file_type =</span> <span class="st">&#39;data&#39;</span>,</span>
<span id="cb328-3"><a href="defining-multi-area-models.html#cb328-3"></a>               <span class="dt">components =</span> <span class="kw">list</span>(<span class="kw">bind_rows</span>(</span>
<span id="cb328-4"><a href="defining-multi-area-models.html#cb328-4"></a>                 <span class="kw">tibble</span>(<span class="dt">year =</span> schedule<span class="op">$</span>year <span class="op">%&gt;%</span><span class="st"> </span>unique,</span>
<span id="cb328-5"><a href="defining-multi-area-models.html#cb328-5"></a>                            <span class="dt">step =</span> <span class="dv">2</span>,</span>
<span id="cb328-6"><a href="defining-multi-area-models.html#cb328-6"></a>                            <span class="dt">defineratios=</span><span class="st">&#39;east&#39;</span>),</span>
<span id="cb328-7"><a href="defining-multi-area-models.html#cb328-7"></a>                 <span class="kw">tibble</span>(<span class="dt">year =</span> schedule<span class="op">$</span>year <span class="op">%&gt;%</span><span class="st"> </span>unique,</span>
<span id="cb328-8"><a href="defining-multi-area-models.html#cb328-8"></a>                             <span class="dt">step =</span> <span class="dv">1</span>,</span>
<span id="cb328-9"><a href="defining-multi-area-models.html#cb328-9"></a>                             <span class="dt">defineratios=</span><span class="st">&#39;west&#39;</span>)</span>
<span id="cb328-10"><a href="defining-multi-area-models.html#cb328-10"></a>                             ))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb328-11"><a href="defining-multi-area-models.html#cb328-11"></a><span class="st">    </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<p>Finally, we modify the stock files for the stocks that should use this migration matrix and time files:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="defining-multi-area-models.html#cb329-1"></a>ling.imm &lt;-</span>
<span id="cb329-2"><a href="defining-multi-area-models.html#cb329-2"></a><span class="st">  </span>ling.imm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb329-3"><a href="defining-multi-area-models.html#cb329-3"></a><span class="st">    </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesmigrate&#39;</span>,</span>
<span id="cb329-4"><a href="defining-multi-area-models.html#cb329-4"></a>                  <span class="dt">yearstepfile =</span> <span class="st">&#39;Modelfiles/migrationtime&#39;</span>,</span>
<span id="cb329-5"><a href="defining-multi-area-models.html#cb329-5"></a>                  <span class="dt">defineratios =</span> <span class="st">&#39;Modelfiles/migration&#39;</span>)</span>
<span id="cb329-6"><a href="defining-multi-area-models.html#cb329-6"></a>ling.mat &lt;-</span>
<span id="cb329-7"><a href="defining-multi-area-models.html#cb329-7"></a><span class="st">  </span>ling.mat<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb329-8"><a href="defining-multi-area-models.html#cb329-8"></a><span class="st">    </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesmigrate&#39;</span>,</span>
<span id="cb329-9"><a href="defining-multi-area-models.html#cb329-9"></a>                  <span class="dt">yearstepfile =</span> <span class="st">&#39;Modelfiles/migrationtime&#39;</span>,</span>
<span id="cb329-10"><a href="defining-multi-area-models.html#cb329-10"></a>                  <span class="dt">defineratios =</span> <span class="st">&#39;Modelfiles/migration&#39;</span>)</span>
<span id="cb329-11"><a href="defining-multi-area-models.html#cb329-11"></a></span>
<span id="cb329-12"><a href="defining-multi-area-models.html#cb329-12"></a><span class="co">## write to file</span></span>
<span id="cb329-13"><a href="defining-multi-area-models.html#cb329-13"></a>ling.imm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb329-14"><a href="defining-multi-area-models.html#cb329-14"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb329-15"><a href="defining-multi-area-models.html#cb329-15"></a></span>
<span id="cb329-16"><a href="defining-multi-area-models.html#cb329-16"></a>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb329-17"><a href="defining-multi-area-models.html#cb329-17"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb329-18"><a href="defining-multi-area-models.html#cb329-18"></a></span>
<span id="cb329-19"><a href="defining-multi-area-models.html#cb329-19"></a>ling.mat</span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## stockname    lingmat
## livesonareas 1   2
## minage   5
## maxage   15
## minlength    20
## maxlength    160
## dl   4
## refweightfile    Modelfiles/lingmat.refwgt
## growthandeatlengths  Aggfiles/lingmat.stock.len.agg
## doesgrow 1
## growthfunction   lengthvbsimple
## growthparameters #ling.Linf  (* 0.001 #ling.k)   #ling.walpha    #ling.wbeta
## beta (* 10 #ling.bbin)
## maxlengthgroupgrowth 15
## naturalmortality #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M
## iseaten  1
## preylengths  Aggfiles/lingmat.stock.len.agg
## energycontent    1
## doeseat  0
## initialconditions
## minage   5
## maxage   15
## minlength    20
## maxlength    160
## dl   4
## normalparamfile  Modelfiles/lingmat.init.normalparam
## doesmigrate  1
## yearstepfile Modelfiles/migrationtime
## defineratios Modelfiles/migration
## doesmature   0
## doesmove 0
## doesrenew    0
## doesspawn    0
## doesstray    0</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="defining-multi-area-models.html#cb331-1"></a><span class="kw">gadget_evaluate</span>(gd,<span class="dt">log =</span> <span class="st">&#39;log_area2&#39;</span>)</span></code></pre></div>
</div>
<div id="using-data-from-multiple-areas" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Using data from multiple areas</h3>
<p>It is also possible to fit a Gadget model using area-specific data.
If data are available from both areas, then there must be fleets operating
in both areas, so the first step is to modify the fleets. This is easily
done in Rgadget by including catch data from both areas and including
area 2 in the attributes:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="defining-multi-area-models.html#cb332-1"></a>lln.landings &lt;-<span class="st"> </span><span class="kw">structure</span>(</span>
<span id="cb332-2"><a href="defining-multi-area-models.html#cb332-2"></a>  <span class="kw">bind_rows</span>(<span class="kw">read_csv</span>(<span class="st">&#39;data_provided/lln.csv&#39;</span>),</span>
<span id="cb332-3"><a href="defining-multi-area-models.html#cb332-3"></a>            <span class="kw">read_csv</span>(<span class="st">&#39;data_provided/lln.csv&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb332-4"><a href="defining-multi-area-models.html#cb332-4"></a><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">area=</span><span class="dv">2</span>,</span>
<span id="cb332-5"><a href="defining-multi-area-models.html#cb332-5"></a>                     <span class="dt">total_weight =</span> <span class="kw">round</span>(total_weight<span class="op">*</span><span class="kw">rlnorm</span>(<span class="kw">n</span>(), <span class="dt">sdlog =</span> <span class="fl">0.5</span>))) <span class="op">%&gt;%</span></span>
<span id="cb332-6"><a href="defining-multi-area-models.html#cb332-6"></a><span class="st">                        </span><span class="kw">filter</span>(total_weight <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)),</span>
<span id="cb332-7"><a href="defining-multi-area-models.html#cb332-7"></a>            <span class="dt">area_group =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span>))</span>
<span id="cb332-8"><a href="defining-multi-area-models.html#cb332-8"></a>bmt.landings &lt;-<span class="st"> </span><span class="kw">structure</span>(</span>
<span id="cb332-9"><a href="defining-multi-area-models.html#cb332-9"></a>  <span class="kw">bind_rows</span>(<span class="kw">read_csv</span>(<span class="st">&#39;data_provided/bmt.csv&#39;</span>),</span>
<span id="cb332-10"><a href="defining-multi-area-models.html#cb332-10"></a>            <span class="kw">read_csv</span>(<span class="st">&#39;data_provided/bmt.csv&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb332-11"><a href="defining-multi-area-models.html#cb332-11"></a><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">area=</span><span class="dv">2</span>,</span>
<span id="cb332-12"><a href="defining-multi-area-models.html#cb332-12"></a>                     <span class="dt">total_weight =</span> <span class="kw">round</span>(total_weight<span class="op">*</span><span class="kw">rlnorm</span>(<span class="kw">n</span>(), <span class="dt">sdlog =</span> <span class="fl">0.5</span>))) <span class="op">%&gt;%</span></span>
<span id="cb332-13"><a href="defining-multi-area-models.html#cb332-13"></a><span class="st">                        </span><span class="kw">filter</span>(total_weight <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)),</span>
<span id="cb332-14"><a href="defining-multi-area-models.html#cb332-14"></a>            <span class="dt">area_group =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span>))</span>
<span id="cb332-15"><a href="defining-multi-area-models.html#cb332-15"></a>gil.landings &lt;-<span class="st"> </span><span class="kw">structure</span>(</span>
<span id="cb332-16"><a href="defining-multi-area-models.html#cb332-16"></a>  <span class="kw">bind_rows</span>(<span class="kw">read_csv</span>(<span class="st">&#39;data_provided/gil.csv&#39;</span>),</span>
<span id="cb332-17"><a href="defining-multi-area-models.html#cb332-17"></a>            <span class="kw">read_csv</span>(<span class="st">&#39;data_provided/gil.csv&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb332-18"><a href="defining-multi-area-models.html#cb332-18"></a><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">area=</span><span class="dv">2</span>,</span>
<span id="cb332-19"><a href="defining-multi-area-models.html#cb332-19"></a>                     <span class="dt">total_weight =</span> <span class="kw">round</span>(total_weight<span class="op">*</span><span class="kw">rlnorm</span>(<span class="kw">n</span>(), <span class="dt">sdlog =</span> <span class="fl">0.5</span>))) <span class="op">%&gt;%</span></span>
<span id="cb332-20"><a href="defining-multi-area-models.html#cb332-20"></a><span class="st">                        </span><span class="kw">filter</span>(total_weight <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)),</span>
<span id="cb332-21"><a href="defining-multi-area-models.html#cb332-21"></a>            <span class="dt">area_group =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span>))</span>
<span id="cb332-22"><a href="defining-multi-area-models.html#cb332-22"></a>for.landings &lt;-<span class="st"> </span><span class="kw">structure</span>(</span>
<span id="cb332-23"><a href="defining-multi-area-models.html#cb332-23"></a>  <span class="kw">bind_rows</span>(<span class="kw">read_csv</span>(<span class="st">&#39;data_provided/for.csv&#39;</span>),</span>
<span id="cb332-24"><a href="defining-multi-area-models.html#cb332-24"></a>            <span class="kw">read_csv</span>(<span class="st">&#39;data_provided/for.csv&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb332-25"><a href="defining-multi-area-models.html#cb332-25"></a><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">area=</span><span class="dv">2</span>,</span>
<span id="cb332-26"><a href="defining-multi-area-models.html#cb332-26"></a>                     <span class="dt">total_weight =</span> <span class="kw">round</span>(total_weight<span class="op">*</span><span class="kw">rlnorm</span>(<span class="kw">n</span>(), <span class="dt">sdlog =</span> <span class="fl">0.5</span>))) <span class="op">%&gt;%</span></span>
<span id="cb332-27"><a href="defining-multi-area-models.html#cb332-27"></a><span class="st">                        </span><span class="kw">filter</span>(total_weight <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)),</span>
<span id="cb332-28"><a href="defining-multi-area-models.html#cb332-28"></a>            <span class="dt">area_group =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span>))</span>
<span id="cb332-29"><a href="defining-multi-area-models.html#cb332-29"></a>surv.landings &lt;-<span class="st"> </span><span class="kw">structure</span>(</span>
<span id="cb332-30"><a href="defining-multi-area-models.html#cb332-30"></a>  <span class="kw">bind_rows</span>(<span class="kw">read_csv</span>(<span class="st">&#39;data_provided/surv.csv&#39;</span>),</span>
<span id="cb332-31"><a href="defining-multi-area-models.html#cb332-31"></a>            <span class="kw">read_csv</span>(<span class="st">&#39;data_provided/surv.csv&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb332-32"><a href="defining-multi-area-models.html#cb332-32"></a><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">area=</span><span class="dv">2</span>)),</span>
<span id="cb332-33"><a href="defining-multi-area-models.html#cb332-33"></a>            <span class="dt">area_group =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span>))</span>
<span id="cb332-34"><a href="defining-multi-area-models.html#cb332-34"></a></span>
<span id="cb332-35"><a href="defining-multi-area-models.html#cb332-35"></a>lln.landings</span></code></pre></div>
<pre><code>## [90m# A tibble: 200 x 4[39m
##     year  step  area total_weight
##  [90m*[39m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m        [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m  [4m1[24m994     1     1       [4m2[24m[4m3[24m[4m2[24m073
## [90m 2[39m  [4m1[24m994     2     1        [4m6[24m[4m3[24m300
## [90m 3[39m  [4m1[24m994     3     1       [4m2[24m[4m3[24m[4m0[24m816
## [90m 4[39m  [4m1[24m994     4     1       [4m4[24m[4m6[24m[4m5[24m965
## [90m 5[39m  [4m1[24m995     1     1       [4m3[24m[4m5[24m[4m1[24m216
## [90m 6[39m  [4m1[24m995     2     1       [4m1[24m[4m5[24m[4m8[24m494
## [90m 7[39m  [4m1[24m995     3     1       [4m1[24m[4m9[24m[4m2[24m527
## [90m 8[39m  [4m1[24m995     4     1       [4m6[24m[4m1[24m[4m7[24m108
## [90m 9[39m  [4m1[24m996     1     1       [4m5[24m[4m1[24m[4m6[24m931
## [90m10[39m  [4m1[24m996     2     1       [4m2[24m[4m8[24m[4m5[24m695
## [90m# … with 190 more rows[39m</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="defining-multi-area-models.html#cb334-1"></a>surv.landings</span></code></pre></div>
<pre><code>## [90m# A tibble: 74 x 4[39m
##     year  step  area number
##  [90m*[39m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m  [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m  [4m1[24m982     2     1      1
## [90m 2[39m  [4m1[24m983     2     1      1
## [90m 3[39m  [4m1[24m984     2     1      1
## [90m 4[39m  [4m1[24m985     2     1      1
## [90m 5[39m  [4m1[24m986     2     1      1
## [90m 6[39m  [4m1[24m987     2     1      1
## [90m 7[39m  [4m1[24m988     2     1      1
## [90m 8[39m  [4m1[24m989     2     1      1
## [90m 9[39m  [4m1[24m990     2     1      1
## [90m10[39m  [4m1[24m991     2     1      1
## [90m# … with 64 more rows[39m</code></pre>
<p>Then when these catch data are included in the fleet files, the areas of operation
with the fleets will be automatically updated. The current Rgadget version cannot
update fleet components separately, so here we rewrite the entire fleet file the
same way we did on day 2.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="defining-multi-area-models.html#cb336-1"></a><span class="kw">gadgetfleet</span>(<span class="st">&#39;Modelfiles/fleet&#39;</span>,gd,<span class="dt">missingOkay =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb336-2"><a href="defining-multi-area-models.html#cb336-2"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;totalfleet&#39;</span>,</span>
<span id="cb336-3"><a href="defining-multi-area-models.html#cb336-3"></a>                <span class="dt">livesonareas =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb336-4"><a href="defining-multi-area-models.html#cb336-4"></a>                <span class="dt">name =</span> <span class="st">&#39;surv&#39;</span>,</span>
<span id="cb336-5"><a href="defining-multi-area-models.html#cb336-5"></a>                <span class="dt">suitability =</span> </span>
<span id="cb336-6"><a href="defining-multi-area-models.html#cb336-6"></a>                  <span class="kw">list</span>(<span class="dt">lingimm =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb336-7"><a href="defining-multi-area-models.html#cb336-7"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.surv.alpha&#39;</span>,</span>
<span id="cb336-8"><a href="defining-multi-area-models.html#cb336-8"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.surv.l50&#39;</span>),</span>
<span id="cb336-9"><a href="defining-multi-area-models.html#cb336-9"></a>                       <span class="dt">lingmat =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb336-10"><a href="defining-multi-area-models.html#cb336-10"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.surv.alpha&#39;</span>,</span>
<span id="cb336-11"><a href="defining-multi-area-models.html#cb336-11"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.surv.l50&#39;</span>)),</span>
<span id="cb336-12"><a href="defining-multi-area-models.html#cb336-12"></a>                <span class="dt">data =</span> surv.landings) <span class="op">%&gt;%</span></span>
<span id="cb336-13"><a href="defining-multi-area-models.html#cb336-13"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;totalfleet&#39;</span>,</span>
<span id="cb336-14"><a href="defining-multi-area-models.html#cb336-14"></a>                <span class="dt">name =</span> <span class="st">&#39;lln&#39;</span>,</span>
<span id="cb336-15"><a href="defining-multi-area-models.html#cb336-15"></a>                <span class="dt">livesonareas =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb336-16"><a href="defining-multi-area-models.html#cb336-16"></a>                <span class="dt">suitability =</span> </span>
<span id="cb336-17"><a href="defining-multi-area-models.html#cb336-17"></a>                  <span class="kw">list</span>(<span class="dt">lingimm =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb336-18"><a href="defining-multi-area-models.html#cb336-18"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.lln.alpha&#39;</span>,</span>
<span id="cb336-19"><a href="defining-multi-area-models.html#cb336-19"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.lln.l50&#39;</span>),</span>
<span id="cb336-20"><a href="defining-multi-area-models.html#cb336-20"></a>                       <span class="dt">lingmat =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb336-21"><a href="defining-multi-area-models.html#cb336-21"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.lln.alpha&#39;</span>,</span>
<span id="cb336-22"><a href="defining-multi-area-models.html#cb336-22"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.lln.l50&#39;</span>)),</span>
<span id="cb336-23"><a href="defining-multi-area-models.html#cb336-23"></a>                <span class="dt">data =</span> lln.landings) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb336-24"><a href="defining-multi-area-models.html#cb336-24"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;totalfleet&#39;</span>,</span>
<span id="cb336-25"><a href="defining-multi-area-models.html#cb336-25"></a>                <span class="dt">name =</span> <span class="st">&#39;bmt&#39;</span>,</span>
<span id="cb336-26"><a href="defining-multi-area-models.html#cb336-26"></a>                <span class="dt">livesonareas =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb336-27"><a href="defining-multi-area-models.html#cb336-27"></a>                <span class="dt">suitability =</span> </span>
<span id="cb336-28"><a href="defining-multi-area-models.html#cb336-28"></a>                  <span class="kw">list</span>(<span class="dt">lingimm =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb336-29"><a href="defining-multi-area-models.html#cb336-29"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.bmt.alpha&#39;</span>,</span>
<span id="cb336-30"><a href="defining-multi-area-models.html#cb336-30"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.bmt.l50&#39;</span>),</span>
<span id="cb336-31"><a href="defining-multi-area-models.html#cb336-31"></a>                       <span class="dt">lingmat =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb336-32"><a href="defining-multi-area-models.html#cb336-32"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.bmt.alpha&#39;</span>,</span>
<span id="cb336-33"><a href="defining-multi-area-models.html#cb336-33"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.bmt.l50&#39;</span>)),</span>
<span id="cb336-34"><a href="defining-multi-area-models.html#cb336-34"></a>                <span class="dt">data =</span> bmt.landings) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb336-35"><a href="defining-multi-area-models.html#cb336-35"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;totalfleet&#39;</span>,</span>
<span id="cb336-36"><a href="defining-multi-area-models.html#cb336-36"></a>                <span class="dt">name =</span> <span class="st">&#39;gil&#39;</span>,</span>
<span id="cb336-37"><a href="defining-multi-area-models.html#cb336-37"></a>                <span class="dt">livesonareas =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb336-38"><a href="defining-multi-area-models.html#cb336-38"></a>                <span class="dt">suitability =</span> </span>
<span id="cb336-39"><a href="defining-multi-area-models.html#cb336-39"></a>                  <span class="kw">list</span>(<span class="dt">lingimm =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb336-40"><a href="defining-multi-area-models.html#cb336-40"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.gil.alpha&#39;</span>,</span>
<span id="cb336-41"><a href="defining-multi-area-models.html#cb336-41"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.gil.l50&#39;</span>),</span>
<span id="cb336-42"><a href="defining-multi-area-models.html#cb336-42"></a>                       <span class="dt">lingmat =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb336-43"><a href="defining-multi-area-models.html#cb336-43"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.gil.alpha&#39;</span>,</span>
<span id="cb336-44"><a href="defining-multi-area-models.html#cb336-44"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.gil.l50&#39;</span>)),</span>
<span id="cb336-45"><a href="defining-multi-area-models.html#cb336-45"></a>                <span class="dt">data =</span> gil.landings) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb336-46"><a href="defining-multi-area-models.html#cb336-46"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;totalfleet&#39;</span>,</span>
<span id="cb336-47"><a href="defining-multi-area-models.html#cb336-47"></a>                <span class="dt">name =</span> <span class="st">&#39;foreign&#39;</span>,</span>
<span id="cb336-48"><a href="defining-multi-area-models.html#cb336-48"></a>                <span class="dt">livesonareas =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb336-49"><a href="defining-multi-area-models.html#cb336-49"></a>                <span class="dt">suitability =</span> </span>
<span id="cb336-50"><a href="defining-multi-area-models.html#cb336-50"></a>                  <span class="kw">list</span>(<span class="dt">lingimm =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb336-51"><a href="defining-multi-area-models.html#cb336-51"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.lln.alpha&#39;</span>,</span>
<span id="cb336-52"><a href="defining-multi-area-models.html#cb336-52"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.lln.l50&#39;</span>),</span>
<span id="cb336-53"><a href="defining-multi-area-models.html#cb336-53"></a>                       <span class="dt">lingmat =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb336-54"><a href="defining-multi-area-models.html#cb336-54"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.lln.alpha&#39;</span>,</span>
<span id="cb336-55"><a href="defining-multi-area-models.html#cb336-55"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.lln.l50&#39;</span>)),</span>
<span id="cb336-56"><a href="defining-multi-area-models.html#cb336-56"></a>                <span class="dt">data =</span> for.landings) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb336-57"><a href="defining-multi-area-models.html#cb336-57"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<p>Now that there are fleets fishing on area 2 with catches removed,
it is possible for biological samples to be generated from area 2.</p>
<p>Because all fish in the model, whether they belong to the area 1 or 2, belong to the
same stocks (immature or mature), they all need to conform to the same stock-related
processes, such as growth, maturation, and selectivity of a fleet as it fishes that
stock. Different stocks would be necessary to change these by area. However, because
initial conditions and recruitment are area-specific, they can be set with different values or
switches. Previously we had written the same parameters for both areas, resulting in mirror
images; here we change these parameters to be area-specific. Also remember that
catchability is also estimated separately by area in relation to survey indices.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="defining-multi-area-models.html#cb337-1"></a>ling.imm &lt;-</span>
<span id="cb337-2"><a href="defining-multi-area-models.html#cb337-2"></a><span class="st">  </span>ling.imm <span class="op">%&gt;%</span></span>
<span id="cb337-3"><a href="defining-multi-area-models.html#cb337-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb337-4"><a href="defining-multi-area-models.html#cb337-4"></a>                <span class="dt">normalparam =</span> </span>
<span id="cb337-5"><a href="defining-multi-area-models.html#cb337-5"></a>                  <span class="kw">expand.grid</span>(<span class="dt">age =</span> ling.imm[[<span class="dv">1</span>]]<span class="op">$</span>minage<span class="op">:</span>ling.imm[[<span class="dv">1</span>]]<span class="op">$</span>maxage, <span class="dt">area =</span> area_file[[<span class="dv">1</span>]]<span class="op">$</span>areas) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-6"><a href="defining-multi-area-models.html#cb337-6"></a><span class="st">                  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-7"><a href="defining-multi-area-models.html#cb337-7"></a><span class="st">                  </span><span class="kw">mutate</span>( </span>
<span id="cb337-8"><a href="defining-multi-area-models.html#cb337-8"></a>                    <span class="dt">age.factor =</span> <span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">sprintf</span>(<span class="st">&#39;exp(-1*(lingimm.M+ling.init.F)*%1$s)*lingimm.init.%1$s&#39;</span>,age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-9"><a href="defining-multi-area-models.html#cb337-9"></a><span class="st">                      </span><span class="kw">map</span>(to.gadget.formulae) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-10"><a href="defining-multi-area-models.html#cb337-10"></a><span class="st">                      </span><span class="kw">unlist</span>(),   </span>
<span id="cb337-11"><a href="defining-multi-area-models.html#cb337-11"></a>                    <span class="dt">area.factor =</span> <span class="kw">sprintf</span>(<span class="st">&#39;#lingimm.init.scalar.%1$s&#39;</span>,area),</span>
<span id="cb337-12"><a href="defining-multi-area-models.html#cb337-12"></a>                    <span class="dt">mean =</span> <span class="kw">von_b_formula</span>(age,<span class="dt">linf=</span><span class="st">&#39;ling.Linf&#39;</span>,<span class="dt">k=</span><span class="st">&#39;ling.k&#39;</span>,<span class="dt">recl=</span><span class="st">&#39;ling.recl&#39;</span>),</span>
<span id="cb337-13"><a href="defining-multi-area-models.html#cb337-13"></a>                    <span class="dt">stddev =</span> <span class="kw">rep</span>(init.sigma.i,<span class="dv">2</span>),</span>
<span id="cb337-14"><a href="defining-multi-area-models.html#cb337-14"></a>                    <span class="dt">alpha =</span> <span class="st">&#39;#ling.walpha&#39;</span>,</span>
<span id="cb337-15"><a href="defining-multi-area-models.html#cb337-15"></a>                    <span class="dt">beta =</span> <span class="st">&#39;#ling.wbeta&#39;</span></span>
<span id="cb337-16"><a href="defining-multi-area-models.html#cb337-16"></a>                    )</span>
<span id="cb337-17"><a href="defining-multi-area-models.html#cb337-17"></a>                ) <span class="op">%&gt;%</span></span>
<span id="cb337-18"><a href="defining-multi-area-models.html#cb337-18"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesrenew&#39;</span>,</span>
<span id="cb337-19"><a href="defining-multi-area-models.html#cb337-19"></a>                <span class="dt">normalparam =</span> </span>
<span id="cb337-20"><a href="defining-multi-area-models.html#cb337-20"></a>                  <span class="kw">expand.grid</span>(<span class="dt">year =</span> schedule<span class="op">$</span>year,<span class="dt">area =</span> area_file[[<span class="dv">1</span>]]<span class="op">$</span>areas) <span class="op">%&gt;%</span></span>
<span id="cb337-21"><a href="defining-multi-area-models.html#cb337-21"></a><span class="st">                  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-22"><a href="defining-multi-area-models.html#cb337-22"></a><span class="st">                  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-23"><a href="defining-multi-area-models.html#cb337-23"></a><span class="st">                  </span><span class="kw">mutate</span>(<span class="dt">step =</span> <span class="dv">1</span>,</span>
<span id="cb337-24"><a href="defining-multi-area-models.html#cb337-24"></a>                         <span class="dt">age =</span> ling.imm[[<span class="dv">1</span>]]<span class="op">$</span>minage,</span>
<span id="cb337-25"><a href="defining-multi-area-models.html#cb337-25"></a>                         <span class="dt">number =</span> <span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">sprintf</span>(<span class="st">&#39;ling.rec.scalar*ling.rec.%1$s.%2$s&#39;</span>,year,area)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-26"><a href="defining-multi-area-models.html#cb337-26"></a><span class="st">                           </span><span class="kw">map</span>(to.gadget.formulae) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-27"><a href="defining-multi-area-models.html#cb337-27"></a><span class="st">                           </span><span class="kw">unlist</span>(),</span>
<span id="cb337-28"><a href="defining-multi-area-models.html#cb337-28"></a>                         <span class="dt">mean =</span> <span class="kw">von_b_formula</span>(age,<span class="dt">linf=</span><span class="st">&#39;ling.Linf&#39;</span>,<span class="dt">k=</span><span class="st">&#39;ling.k&#39;</span>,<span class="dt">recl=</span><span class="st">&#39;ling.recl&#39;</span>),</span>
<span id="cb337-29"><a href="defining-multi-area-models.html#cb337-29"></a>                         <span class="dt">stddev =</span> <span class="st">&#39;#ling.rec.sd&#39;</span>,</span>
<span id="cb337-30"><a href="defining-multi-area-models.html#cb337-30"></a>                         <span class="dt">alpha =</span> <span class="st">&#39;#ling.walpha&#39;</span>,</span>
<span id="cb337-31"><a href="defining-multi-area-models.html#cb337-31"></a>                         <span class="dt">beta =</span> <span class="st">&#39;#ling.wbeta&#39;</span></span>
<span id="cb337-32"><a href="defining-multi-area-models.html#cb337-32"></a>                         )</span>
<span id="cb337-33"><a href="defining-multi-area-models.html#cb337-33"></a>                ) </span>
<span id="cb337-34"><a href="defining-multi-area-models.html#cb337-34"></a></span>
<span id="cb337-35"><a href="defining-multi-area-models.html#cb337-35"></a>ling.mat &lt;-</span>
<span id="cb337-36"><a href="defining-multi-area-models.html#cb337-36"></a><span class="st">  </span>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-37"><a href="defining-multi-area-models.html#cb337-37"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb337-38"><a href="defining-multi-area-models.html#cb337-38"></a>                <span class="dt">normalparam =</span> <span class="kw">expand.grid</span>(<span class="dt">age =</span> ling.mat[[<span class="dv">1</span>]]<span class="op">$</span>minage<span class="op">:</span>ling.mat[[<span class="dv">1</span>]]<span class="op">$</span>maxage, <span class="dt">area =</span> area_file[[<span class="dv">1</span>]]<span class="op">$</span>areas) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-39"><a href="defining-multi-area-models.html#cb337-39"></a><span class="st">                  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-40"><a href="defining-multi-area-models.html#cb337-40"></a><span class="st">                  </span><span class="kw">mutate</span>(</span>
<span id="cb337-41"><a href="defining-multi-area-models.html#cb337-41"></a>                    <span class="dt">age.factor =</span> <span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">sprintf</span>(<span class="st">&#39;exp(-1*(lingmat.M+ling.init.F)*%1$s)*lingmat.init.%1$s&#39;</span>,age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-42"><a href="defining-multi-area-models.html#cb337-42"></a><span class="st">                      </span><span class="kw">map</span>(to.gadget.formulae) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-43"><a href="defining-multi-area-models.html#cb337-43"></a><span class="st">                      </span><span class="kw">unlist</span>(),</span>
<span id="cb337-44"><a href="defining-multi-area-models.html#cb337-44"></a>                    <span class="dt">area.factor =</span> <span class="kw">sprintf</span>(<span class="st">&#39;#lingmat.init.scalar.%1$s&#39;</span>,area),</span>
<span id="cb337-45"><a href="defining-multi-area-models.html#cb337-45"></a>                    <span class="dt">mean =</span> <span class="kw">von_b_formula</span>(age,<span class="dt">linf=</span><span class="st">&#39;ling.Linf&#39;</span>,<span class="dt">k=</span><span class="st">&#39;ling.k&#39;</span>,<span class="dt">recl=</span><span class="st">&#39;ling.recl&#39;</span>),</span>
<span id="cb337-46"><a href="defining-multi-area-models.html#cb337-46"></a>                    <span class="dt">stddev =</span> <span class="kw">rep</span>(init.sigma.m,<span class="dv">2</span>),</span>
<span id="cb337-47"><a href="defining-multi-area-models.html#cb337-47"></a>                    <span class="dt">alpha =</span> <span class="st">&#39;#lingmat.walpha&#39;</span>,</span>
<span id="cb337-48"><a href="defining-multi-area-models.html#cb337-48"></a>                    <span class="dt">beta =</span> <span class="st">&#39;#lingmat.wbeta&#39;</span></span>
<span id="cb337-49"><a href="defining-multi-area-models.html#cb337-49"></a>                    )</span>
<span id="cb337-50"><a href="defining-multi-area-models.html#cb337-50"></a>                )  </span>
<span id="cb337-51"><a href="defining-multi-area-models.html#cb337-51"></a><span class="co">## write to file</span></span>
<span id="cb337-52"><a href="defining-multi-area-models.html#cb337-52"></a>ling.imm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-53"><a href="defining-multi-area-models.html#cb337-53"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb337-54"><a href="defining-multi-area-models.html#cb337-54"></a></span>
<span id="cb337-55"><a href="defining-multi-area-models.html#cb337-55"></a>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb337-56"><a href="defining-multi-area-models.html#cb337-56"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<p>Finally, these data can be used to rewrite the likelihood function.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="defining-multi-area-models.html#cb338-1"></a>lik &lt;-</span>
<span id="cb338-2"><a href="defining-multi-area-models.html#cb338-2"></a><span class="st">  </span><span class="kw">gadgetlikelihood</span>(<span class="st">&#39;likelihood&#39;</span>,gd,<span class="dt">missingOkay =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-3"><a href="defining-multi-area-models.html#cb338-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;catchdistribution&quot;</span>,</span>
<span id="cb338-4"><a href="defining-multi-area-models.html#cb338-4"></a>                <span class="dt">name =</span> <span class="st">&quot;ldist.surv&quot;</span>,</span>
<span id="cb338-5"><a href="defining-multi-area-models.html#cb338-5"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-6"><a href="defining-multi-area-models.html#cb338-6"></a>                <span class="dt">data =</span> ldist.surv,</span>
<span id="cb338-7"><a href="defining-multi-area-models.html#cb338-7"></a>                <span class="dt">fleetnames =</span> <span class="kw">c</span>(<span class="st">&quot;surv&quot;</span>),</span>
<span id="cb338-8"><a href="defining-multi-area-models.html#cb338-8"></a>                <span class="dt">stocknames =</span><span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-9"><a href="defining-multi-area-models.html#cb338-9"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;catchdistribution&quot;</span>,</span>
<span id="cb338-10"><a href="defining-multi-area-models.html#cb338-10"></a>                <span class="dt">name =</span> <span class="st">&quot;aldist.surv&quot;</span>,</span>
<span id="cb338-11"><a href="defining-multi-area-models.html#cb338-11"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-12"><a href="defining-multi-area-models.html#cb338-12"></a>                <span class="dt">data =</span> aldist.surv, </span>
<span id="cb338-13"><a href="defining-multi-area-models.html#cb338-13"></a>                <span class="dt">fleetnames =</span> <span class="kw">c</span>(<span class="st">&quot;surv&quot;</span>),</span>
<span id="cb338-14"><a href="defining-multi-area-models.html#cb338-14"></a>                <span class="dt">stocknames =</span><span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-15"><a href="defining-multi-area-models.html#cb338-15"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;catchdistribution&quot;</span>,</span>
<span id="cb338-16"><a href="defining-multi-area-models.html#cb338-16"></a>                <span class="dt">name =</span> <span class="st">&quot;ldist.lln&quot;</span>,</span>
<span id="cb338-17"><a href="defining-multi-area-models.html#cb338-17"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-18"><a href="defining-multi-area-models.html#cb338-18"></a>                <span class="dt">data =</span> ldist.lln, </span>
<span id="cb338-19"><a href="defining-multi-area-models.html#cb338-19"></a>                <span class="dt">fleetnames =</span> <span class="kw">c</span>(<span class="st">&quot;lln&quot;</span>),</span>
<span id="cb338-20"><a href="defining-multi-area-models.html#cb338-20"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-21"><a href="defining-multi-area-models.html#cb338-21"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;catchdistribution&quot;</span>,</span>
<span id="cb338-22"><a href="defining-multi-area-models.html#cb338-22"></a>                <span class="dt">name =</span> <span class="st">&quot;aldist.lln&quot;</span>,</span>
<span id="cb338-23"><a href="defining-multi-area-models.html#cb338-23"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-24"><a href="defining-multi-area-models.html#cb338-24"></a>                  <span class="dt">data =</span> aldist.lln,</span>
<span id="cb338-25"><a href="defining-multi-area-models.html#cb338-25"></a>                <span class="dt">fleetnames =</span> <span class="kw">c</span>(<span class="st">&quot;lln&quot;</span>),</span>
<span id="cb338-26"><a href="defining-multi-area-models.html#cb338-26"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-27"><a href="defining-multi-area-models.html#cb338-27"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;catchdistribution&quot;</span>,</span>
<span id="cb338-28"><a href="defining-multi-area-models.html#cb338-28"></a>                <span class="dt">name =</span> <span class="st">&quot;ldist.gil&quot;</span>,</span>
<span id="cb338-29"><a href="defining-multi-area-models.html#cb338-29"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-30"><a href="defining-multi-area-models.html#cb338-30"></a>                <span class="dt">data =</span> ldist.gil,</span>
<span id="cb338-31"><a href="defining-multi-area-models.html#cb338-31"></a>                <span class="dt">fleetnames =</span> <span class="kw">c</span>(<span class="st">&quot;gil&quot;</span>),</span>
<span id="cb338-32"><a href="defining-multi-area-models.html#cb338-32"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-33"><a href="defining-multi-area-models.html#cb338-33"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;catchdistribution&quot;</span>,</span>
<span id="cb338-34"><a href="defining-multi-area-models.html#cb338-34"></a>                <span class="dt">name =</span> <span class="st">&quot;aldist.gil&quot;</span>,</span>
<span id="cb338-35"><a href="defining-multi-area-models.html#cb338-35"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-36"><a href="defining-multi-area-models.html#cb338-36"></a>                <span class="dt">data =</span> aldist.gil,</span>
<span id="cb338-37"><a href="defining-multi-area-models.html#cb338-37"></a>                <span class="dt">fleetnames =</span> <span class="kw">c</span>(<span class="st">&quot;gil&quot;</span>),</span>
<span id="cb338-38"><a href="defining-multi-area-models.html#cb338-38"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-39"><a href="defining-multi-area-models.html#cb338-39"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;catchdistribution&quot;</span>,</span>
<span id="cb338-40"><a href="defining-multi-area-models.html#cb338-40"></a>                <span class="dt">name =</span> <span class="st">&quot;ldist.bmt&quot;</span>,</span>
<span id="cb338-41"><a href="defining-multi-area-models.html#cb338-41"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-42"><a href="defining-multi-area-models.html#cb338-42"></a>                <span class="dt">data =</span> ldist.bmt,</span>
<span id="cb338-43"><a href="defining-multi-area-models.html#cb338-43"></a>                <span class="dt">fleetnames =</span> <span class="kw">c</span>(<span class="st">&quot;bmt&quot;</span>),</span>
<span id="cb338-44"><a href="defining-multi-area-models.html#cb338-44"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-45"><a href="defining-multi-area-models.html#cb338-45"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;catchdistribution&quot;</span>,</span>
<span id="cb338-46"><a href="defining-multi-area-models.html#cb338-46"></a>                <span class="dt">name =</span> <span class="st">&quot;aldist.bmt&quot;</span>,</span>
<span id="cb338-47"><a href="defining-multi-area-models.html#cb338-47"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-48"><a href="defining-multi-area-models.html#cb338-48"></a>                <span class="dt">data =</span> aldist.bmt,</span>
<span id="cb338-49"><a href="defining-multi-area-models.html#cb338-49"></a>                <span class="dt">fleetnames =</span> <span class="kw">c</span>(<span class="st">&quot;bmt&quot;</span>),</span>
<span id="cb338-50"><a href="defining-multi-area-models.html#cb338-50"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-51"><a href="defining-multi-area-models.html#cb338-51"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;stockdistribution&quot;</span>,</span>
<span id="cb338-52"><a href="defining-multi-area-models.html#cb338-52"></a>                <span class="dt">name =</span> <span class="st">&quot;matp.surv&quot;</span>,</span>
<span id="cb338-53"><a href="defining-multi-area-models.html#cb338-53"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-54"><a href="defining-multi-area-models.html#cb338-54"></a>                  <span class="dt">data =</span> matp.surv,</span>
<span id="cb338-55"><a href="defining-multi-area-models.html#cb338-55"></a>                <span class="dt">fleetnames =</span> <span class="kw">c</span>(<span class="st">&quot;surv&quot;</span>),</span>
<span id="cb338-56"><a href="defining-multi-area-models.html#cb338-56"></a>                <span class="dt">stocknames =</span><span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb338-57"><a href="defining-multi-area-models.html#cb338-57"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;surveyindices&quot;</span>,</span>
<span id="cb338-58"><a href="defining-multi-area-models.html#cb338-58"></a>                <span class="dt">name =</span> <span class="kw">paste0</span>(<span class="st">&quot;si.&quot;</span>, <span class="kw">names</span>(slices)[<span class="dv">1</span>]),</span>
<span id="cb338-59"><a href="defining-multi-area-models.html#cb338-59"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-60"><a href="defining-multi-area-models.html#cb338-60"></a>                <span class="dt">data =</span> SI1,</span>
<span id="cb338-61"><a href="defining-multi-area-models.html#cb338-61"></a>                <span class="dt">fittype =</span> <span class="st">&#39;loglinearfit&#39;</span>,</span>
<span id="cb338-62"><a href="defining-multi-area-models.html#cb338-62"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-63"><a href="defining-multi-area-models.html#cb338-63"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;surveyindices&quot;</span>,</span>
<span id="cb338-64"><a href="defining-multi-area-models.html#cb338-64"></a>                <span class="dt">name =</span> <span class="kw">paste0</span>(<span class="st">&quot;si.&quot;</span>, <span class="kw">names</span>(slices)[<span class="dv">2</span>]),</span>
<span id="cb338-65"><a href="defining-multi-area-models.html#cb338-65"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-66"><a href="defining-multi-area-models.html#cb338-66"></a>                <span class="dt">data =</span> SI2,</span>
<span id="cb338-67"><a href="defining-multi-area-models.html#cb338-67"></a>                <span class="dt">fittype =</span> <span class="st">&#39;loglinearfit&#39;</span>,</span>
<span id="cb338-68"><a href="defining-multi-area-models.html#cb338-68"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-69"><a href="defining-multi-area-models.html#cb338-69"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;surveyindices&quot;</span>,</span>
<span id="cb338-70"><a href="defining-multi-area-models.html#cb338-70"></a>                <span class="dt">name =</span> <span class="kw">paste0</span>(<span class="st">&quot;si.&quot;</span>, <span class="kw">names</span>(slices)[<span class="dv">3</span>]),</span>
<span id="cb338-71"><a href="defining-multi-area-models.html#cb338-71"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-72"><a href="defining-multi-area-models.html#cb338-72"></a>                <span class="dt">data =</span> SI3,</span>
<span id="cb338-73"><a href="defining-multi-area-models.html#cb338-73"></a>                <span class="dt">fittype =</span> <span class="st">&#39;fixedslopeloglinearfit&#39;</span>,</span>
<span id="cb338-74"><a href="defining-multi-area-models.html#cb338-74"></a>                <span class="dt">slope=</span><span class="dv">1</span>,</span>
<span id="cb338-75"><a href="defining-multi-area-models.html#cb338-75"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-76"><a href="defining-multi-area-models.html#cb338-76"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;surveyindices&quot;</span>,</span>
<span id="cb338-77"><a href="defining-multi-area-models.html#cb338-77"></a>                <span class="dt">name =</span> <span class="kw">paste0</span>(<span class="st">&quot;si.&quot;</span>, <span class="kw">names</span>(slices)[<span class="dv">4</span>]),</span>
<span id="cb338-78"><a href="defining-multi-area-models.html#cb338-78"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-79"><a href="defining-multi-area-models.html#cb338-79"></a>                <span class="dt">data =</span> SI4,</span>
<span id="cb338-80"><a href="defining-multi-area-models.html#cb338-80"></a>                <span class="dt">fittype =</span> <span class="st">&#39;fixedslopeloglinearfit&#39;</span>,</span>
<span id="cb338-81"><a href="defining-multi-area-models.html#cb338-81"></a>                <span class="dt">slope=</span><span class="dv">1</span>,</span>
<span id="cb338-82"><a href="defining-multi-area-models.html#cb338-82"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-83"><a href="defining-multi-area-models.html#cb338-83"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;surveyindices&quot;</span>,</span>
<span id="cb338-84"><a href="defining-multi-area-models.html#cb338-84"></a>                <span class="dt">name =</span> <span class="kw">paste0</span>(<span class="st">&quot;si.&quot;</span>, <span class="kw">names</span>(slices)[<span class="dv">5</span>]),</span>
<span id="cb338-85"><a href="defining-multi-area-models.html#cb338-85"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-86"><a href="defining-multi-area-models.html#cb338-86"></a>                <span class="dt">data =</span> SI5,</span>
<span id="cb338-87"><a href="defining-multi-area-models.html#cb338-87"></a>                <span class="dt">fittype =</span> <span class="st">&#39;fixedslopeloglinearfit&#39;</span>,</span>
<span id="cb338-88"><a href="defining-multi-area-models.html#cb338-88"></a>                <span class="dt">slope=</span><span class="dv">1</span>,</span>
<span id="cb338-89"><a href="defining-multi-area-models.html#cb338-89"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-90"><a href="defining-multi-area-models.html#cb338-90"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;surveyindices&quot;</span>,</span>
<span id="cb338-91"><a href="defining-multi-area-models.html#cb338-91"></a>                <span class="dt">name =</span> <span class="kw">paste0</span>(<span class="st">&quot;si.&quot;</span>, <span class="kw">names</span>(slices)[<span class="dv">6</span>]),</span>
<span id="cb338-92"><a href="defining-multi-area-models.html#cb338-92"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-93"><a href="defining-multi-area-models.html#cb338-93"></a>                <span class="dt">data =</span> SI6,</span>
<span id="cb338-94"><a href="defining-multi-area-models.html#cb338-94"></a>                <span class="dt">fittype =</span> <span class="st">&#39;fixedslopeloglinearfit&#39;</span>,</span>
<span id="cb338-95"><a href="defining-multi-area-models.html#cb338-95"></a>                <span class="dt">slope=</span><span class="dv">1</span>,</span>
<span id="cb338-96"><a href="defining-multi-area-models.html#cb338-96"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-97"><a href="defining-multi-area-models.html#cb338-97"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;surveyindices&quot;</span>,</span>
<span id="cb338-98"><a href="defining-multi-area-models.html#cb338-98"></a>                <span class="dt">name =</span> <span class="kw">paste0</span>(<span class="st">&quot;si.&quot;</span>, <span class="kw">names</span>(slices)[<span class="dv">7</span>]),</span>
<span id="cb338-99"><a href="defining-multi-area-models.html#cb338-99"></a>                <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb338-100"><a href="defining-multi-area-models.html#cb338-100"></a>                <span class="dt">data =</span> SI7,</span>
<span id="cb338-101"><a href="defining-multi-area-models.html#cb338-101"></a>                <span class="dt">fittype =</span> <span class="st">&#39;fixedslopeloglinearfit&#39;</span>,</span>
<span id="cb338-102"><a href="defining-multi-area-models.html#cb338-102"></a>                <span class="dt">slope=</span><span class="dv">1</span>,</span>
<span id="cb338-103"><a href="defining-multi-area-models.html#cb338-103"></a>                <span class="dt">stocknames =</span> <span class="kw">c</span>(<span class="st">&quot;lingimm&quot;</span>,<span class="st">&quot;lingmat&quot;</span>))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-104"><a href="defining-multi-area-models.html#cb338-104"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;penalty&quot;</span>,</span>
<span id="cb338-105"><a href="defining-multi-area-models.html#cb338-105"></a>                <span class="dt">name =</span> <span class="st">&quot;bounds&quot;</span>,</span>
<span id="cb338-106"><a href="defining-multi-area-models.html#cb338-106"></a>                <span class="dt">weight =</span> <span class="st">&quot;0.5&quot;</span>,</span>
<span id="cb338-107"><a href="defining-multi-area-models.html#cb338-107"></a>                <span class="dt">data =</span> <span class="kw">data.frame</span>(</span>
<span id="cb338-108"><a href="defining-multi-area-models.html#cb338-108"></a>                  <span class="dt">switch =</span> <span class="kw">c</span>(<span class="st">&quot;default&quot;</span>),</span>
<span id="cb338-109"><a href="defining-multi-area-models.html#cb338-109"></a>                  <span class="dt">power =</span> <span class="kw">c</span>(<span class="dv">2</span>),</span>
<span id="cb338-110"><a href="defining-multi-area-models.html#cb338-110"></a>                  <span class="dt">upperW=</span><span class="dv">10000</span>,</span>
<span id="cb338-111"><a href="defining-multi-area-models.html#cb338-111"></a>                  <span class="dt">lowerW=</span><span class="dv">10000</span>,</span>
<span id="cb338-112"><a href="defining-multi-area-models.html#cb338-112"></a>                  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb338-113"><a href="defining-multi-area-models.html#cb338-113"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&quot;understocking&quot;</span>,</span>
<span id="cb338-114"><a href="defining-multi-area-models.html#cb338-114"></a>                <span class="dt">name =</span> <span class="st">&quot;understocking&quot;</span>,</span>
<span id="cb338-115"><a href="defining-multi-area-models.html#cb338-115"></a>                <span class="dt">weight =</span> <span class="st">&quot;100&quot;</span>)</span>
<span id="cb338-116"><a href="defining-multi-area-models.html#cb338-116"></a></span>
<span id="cb338-117"><a href="defining-multi-area-models.html#cb338-117"></a>lik <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb338-118"><a href="defining-multi-area-models.html#cb338-118"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<div id="exercise-7" class="section level4">
<h4><span class="header-section-number">8.1.2.1</span> Exercise</h4>
<ul>
<li><p>Now that the area model is set up with new parameters and area structure, 1) use <code>callGadget</code>
to create a new parameters file, 2) use <code>init_guess</code> to set bounds and initial starting values
of all parameters in the new parameters file, and 3) use <code>callGadget</code> again to take create
another parameter file that contains reasonable starting values for a longer Gadget optimization
run, and use 4) <code>gadget.reiterative</code> to create a final model run with decent
weights among data sources. If you are not sure where to start, look back at
the procedure in day 3.</p></li>
<li><p>Now run gadget.fit on the results and create model fit figures that are area-specific.</p></li>
</ul>
<pre><code>## [1] &quot;ling_model/01-base&quot;
## attr(,&quot;mainfile&quot;)
## [1] &quot;main&quot;
## attr(,&quot;class&quot;)
## [1] &quot;gadget.variant&quot; &quot;list&quot;</code></pre>
<pre><code>## [90m# A tibble: 122 x 5[39m
##    switch                       value    lower upper optimise
##  [90m*[39m [3m[90m&lt;chr&gt;[39m[23m                        [3m[90m&lt;dbl&gt;[39m[23m    [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m    [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m ling.Linf             160          1.00[90me[39m+ 2   200        1
## [90m 2[39m ling.k                 90          4.00[90me[39m+ 1   100        1
## [90m 3[39m ling.walpha             0.000[4m0[24m[4m0[24m[4m2[24m28 1.00[90me[39m[31m-10[39m     1        0
## [90m 4[39m ling.wbeta              3.2        2.00[90me[39m+ 0     4        0
## [90m 5[39m ling.bbin               6          1.00[90me[39m[31m- 8[39m   100        1
## [90m 6[39m lingimm.M               0.15       1.00[90me[39m[31m- 3[39m     1        0
## [90m 7[39m lingimm.init.scalar.1 200          1.00[90me[39m+ 0   300        1
## [90m 8[39m lingimm.init.scalar.2 200          1.00[90me[39m+ 0   300        1
## [90m 9[39m ling.init.F             0.4        1.00[90me[39m[31m- 1[39m     1        1
## [90m10[39m lingimm.init.3          1          1.00[90me[39m[31m- 3[39m  [4m1[24m000        1
## [90m# … with 112 more rows[39m</code></pre>
<pre><code>## [1] &quot;ling_model/01-base&quot;
## attr(,&quot;mainfile&quot;)
## [1] &quot;main&quot;
## attr(,&quot;class&quot;)
## [1] &quot;gadget.variant&quot; &quot;list&quot;</code></pre>
<pre><code>## ##------ Wed Nov 18 10:55:59 2020 ------##</code></pre>
<pre><code>## ##------ Wed Nov 18 11:03:44 2020 ------##</code></pre>
<pre><code>## [1] &quot;Reading input data&quot;
## [1] &quot;Running Gadget&quot;
## [1] &quot;Reading output files&quot;
## [1] &quot;Gathering results&quot;
## [1] &quot;Merging input and output&quot;</code></pre>
<p><img src="day4_multi_area_files/figure-html/unnamed-chunk-14-1.png" width="672" /><img src="day4_multi_area_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fitting-a-model-to-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="marine-mammals.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hafro/gadget-course/edit/master/day4_multi_area.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/hafro/gadget-course/blob/master/day4_multi_area.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
